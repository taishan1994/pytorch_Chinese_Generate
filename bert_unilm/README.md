# Bert_Unilm
修改bert的注意力使其具备文本生成的能力。预测的时候，输入的是一篇文本，输出的是文本的标题。这里使用的解码方式是贪婪解码。如何训练自己的数据？

- 1、将数据保存在data文件夹下。
- 2、在data_loader.py中定义数据的读取方式，具体可参考其它数据的格式。
- 3、在main.py里面新增数据加载的方式，最后使用相关的指令运行即可。

训练好的模型和数据下载：<br>

链接：https://pan.baidu.com/s/1CRD5eo1QZxt34K4BrBnC7w?pwd=kwye  <br>
提取码：kwye<br>

# 依赖

```python
torch==1.6.0
transformers==4.5.0
tensorboardX
rouge
```

# 运行

## cnews数据集

### 训练

```python
!python main.py --seed=110 --batch_size=16 --train_epochs=40 --max_seq_len=256 --gen_max_len=50 --data_name="cnews" --do_train="True" --do_test="False" --do_generate="False"
```

### 测试和预测

```python
!python main.py --seed=123 --batch_size=16 --train_epochs=40 --max_seq_len=256 --gen_max_len=50 --data_name="cnews" --do_train="False" --do_test="True" --do_generate="True"
```

### 结果

训练到4个epoch左右自己手动停止了。

```python
{'rouge-1': 0.37571854475104877, 'rouge-2': 0.23240619332385432, 'rouge-l': 0.34973565727146083, 'bleu': 0.13284531504762534}

真实： 国务院要求确保出口产品在国际市场份额新华社北京5月27日电
预测： 温家宝主持召开国务院常务会议新华网北京12月27日电
====================================================================================================
真实： 钟伟房地产行业短期不会进行深度调整  
预测： 万科蓝山蓝山对话：东扩地区房价上涨新浪财经讯
====================================================================================================
真实： 胡锦涛在莫斯科会见俄罗斯总理普京中新网莫斯科六月十七日电
预测： 胡锦涛会见俄罗斯总理普京中新社莫斯科十七日电
====================================================================================================
真实： 《九州》冬日激情
预测： 《风云再起》双倍采集
====================================================================================================
真实： 澳移民子女成长记：带着中国心融入主流社会新华网悉尼5月31日电
预测： 澳大利亚新移民家庭面临代沟问题新华网澳大利亚10月8日电
====================================================================================================
```

## WeiBo数据集

### 训练

```python
!python main.py --seed=110 --batch_size=16 --train_epochs=40 --max_seq_len=256 --gen_max_len=50 --data_name="weibo" --do_train="True" --do_test="False" --do_generate="False"
```

### 测试和预测

```python
!python main.py --seed=123 --batch_size=16 --train_epochs=40 --max_seq_len=256 --gen_max_len=50 --data_name="weibo" --do_train="False" --do_test="True" --do_generate="True"
```

### 结果

训练到4个epoch左右自己手动停止了。

```python
{'rouge-1': 0.46429294927476195, 'rouge-2': 0.32064319422170556, 'rouge-l': 0.4310138557310189, 'bleu': 0.21673876972587966}

真实： 大胸Max要出专辑了！[吃惊]
预测： 《破产姐妹》新专辑9月3日面世！[doge]
====================================================================================================
真实： 男子高速被查冲交警叫嚣：你不要开罚单，我是政协委员[吃惊]
预测： 男子高速被查冲交警叫嚣：你不要开罚单，我是政协委员
====================================================================================================
真实： 转给女生！老民警给女儿的16条安全忠告[推荐]
预测： [话筒]防人之技不可无！[话筒]
====================================================================================================
真实： 对话郎平：我没考虑过新合同，女排精神不是讲故事和心灵鸡汤
预测： 郎平：我没有考虑过过女排精神，我没有考虑这件事，我没有考虑过过女排精神，我没有考虑过过的事
====================================================================================================
真实： 谢亚龙称遭刑讯逼供被灌凉水电击心脏 公安否认
预测： 谢亚龙受审时就我一个人，不能提供证据
```

## duilian数据集

### 训练

这里只训练了5000步左右。

```python
!python main.py --seed=110 --batch_size=32 --train_epochs=40 --max_seq_len=128 --gen_max_len=64 --data_name="duilian" --do_train="True" --do_test="True" --do_generate="True"
```

### 测试和预测

```python
!python main.py --seed=123 --batch_size=32 --train_epochs=40 --max_seq_len=128 --gen_max_len=64 --data_name="duilian" --do_train="False" --do_test="True" --do_generate="True"
```

### 结果

```python
{'rouge-1': 0.11400395089658395, 'rouge-2': 0.008659824457947767, 'rouge-l': 0.1100357182946187, 'bleu': 0.01901977898704231}

文本： 昌水潆洄，万顷流光映梵宇
真实： 瑞山缭绕，四围爽气浮祗园
预测： 春风送暖，一轮明月照禅心
====================================================================================================
文本： 欲踏清风寻瘦柳
真实： 更持红烛赏落花
预测： 欲寻明月觅新梅
====================================================================================================
文本： 你自何来？来就吃，吃完就走
真实： 佛朝此看，看还笑，笑罢还思
预测： 我从此去，去也去，去去也来
====================================================================================================
文本： 心共青烟三界外
真实： 人随日月五行中
预测： 情同白雪一江边
====================================================================================================
文本： 水转千遭归大海
真实： 云腾万里傲长天
预测： 风吹万里入长空
====================================================================================================
文本： 风舞云霞梦
真实： 雨歌岁月情
预测： 雨淋日月心
====================================================================================================
文本： 秀语夺山绿
真实： 奇情破天悭
预测： 春风拂地红
====================================================================================================
文本： 登阁宜远目，试看取秋水长天，落霞孤鹜
真实： 揽胜废清谈，莫辜负青云壮志，白首雄心
预测： 登楼莫轻舟，且看看秋风一路，落日孤帆
====================================================================================================
文本： 山领京东胜，偕暮雨苍岩，造化同分，自古高峰能挂月
真实： 钟敲冀北醒，聚三盘八石，醍醐并受，从来道妙溯栖云
预测： 天开天下境，看高山碧水，风光共赏，从来大地可登天
====================================================================================================
文本： 微信微友微电影
真实： 重仁重亲重家风
预测： 微微微信微微联
====================================================================================================
```

# 参考

> 模型参考：https://github.com/wakafengfan/unilm-pytorch

